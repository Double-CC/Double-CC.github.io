---
layout:     post
title:      "卡尔曼滤波：高斯过程 + 贝叶斯推断"
subtitle:   "chaitong"
date:       2020-05-24
author:     "CT"
header-img: "img/blog-bg.jpg"
tags:
    - 算法
    - 机器学习
---
# 前言
- PRML中提到，卡尔曼滤波是高斯过程的一种应用，本文便从高斯过程的角度来总结一下卡尔曼滤波；
- 首先明确卡尔曼滤波包括两部分：预测和更新。预测就是根据系统上一时刻的状态最优估计$S_{k-1}$预测当前时刻的状态$S_{k}$；更新就是通过当前时刻的观察值$Z_k$更新当前时刻的状态预测值，作为当前时刻的最优估计$S_{k}'$。以此方法迭代。
- 其次明确系统的真实状态是确定的、唯一的，但是！！我们得到的所有估计值都是不确定的，是一个随机变量，因此使用二阶统计量（均值、协方差）来描述。
# 预测（高斯过程）
- 设上一时刻的系统状态的最优估计为 $S_{k-1}$，其服从多元高斯分布：

$$S_{k-1}\sim\mathcal{N}(\hat{x}_{k-1},P_{k-1})$$

- 系统状态空间方程描述了状态转换的规则：

$$S_{k}=F_kS_{k-1}+B_ku_k$$

$F_k$状态转移矩阵，$B_k$控制矩阵，$u_k$控制量；
- 由上一时刻系统状态随机变量$S_{k-1}$转换到当前时刻系统状态随机变量$S_{k}$就是一个高斯过程，我们虽然对该转换进行了建模（状态空间方程），但是仍然存在一些不可控因素（风阻、打滑、突发事件等），因此加入独立随机噪声$\epsilon\sim\mathcal{N}(\mathbf{0},Q_k)$，因此真实的状态空间方程应该是这样的：

$$S_{k}=F_kS_{k-1}+B_ku_k+\epsilon$$

- 因此可以得到当前时刻系统状态随机变量$S_k$的分布：

$$S_{k}\sim\mathcal{N}(\hat{x}_{k},P_{k})$$

其中：

$$\hat{x}_{k}=F_k\hat{x}_{k-1}+B_ku_k\tag{1}$$

$$P_k=F_kP_{k-1}F_k^T+Q_k\tag{2}$$

- 至此我们便完成了预测过程！哦对了，因为我们的观测值和真实的状态值可能由于单位等原因并不完全相等，还需要一个从状态空间到观测空间的映射矩阵$H_k$，因此，系统观测随机变量就服从分布：

$$S_{k}\sim\mathcal{N}(H_k\hat{x}_{k},H_kP_{k}H_k^T)$$

- 例如一个二维的状态空间：
![img](/img/kalmanfilter_1.png)
# 更新（贝叶斯推断）
- 在预测阶段，我们已经得到了系统当前时刻的状态分布，这在贝叶斯推断中相当于先验估计，因为我们没有任何的实际数据作为支撑；此时如果我们引入传感器的观测值，便可以根据观测值更新系统状态，得到后验分布；
- 由于传感器有一定的误差，因此观测值也是个随机变量 $Z_k$。卡尔曼滤波中是这样描述观测值的：假设传感器读取到的观测值为 $z_k$，那么我们就以 $z_k $为均值，协方差为 $R_k$ ，来构造观测变量的多元高斯分布，其中协方差 $R_k$ 取决于传感器的精度：
$$Z_{k}\sim\mathcal{N}(z_{k},R_{k})$$
![img](/img/kalmanfilter_2.png)
- 该$Z_k$的分布实际上就是系统状态的似然估计（根据观测量确定系统状态最有能落在哪个位置，叫做似然），有了先验和似然，相乘就是后验：
![img](/img/kalmanfilter_3.png)
- 由于似然和先验都是高斯分布，根据共轭分布原理，后验分布也服从高斯分布：

$$S_{k}'\sim\mathcal{N}(\mu',\Sigma')$$

其中：

$$\mu'=\mu_0+K(\mu_1-\mu_0)=H_k\hat{x}_{k}+K(z_{k}-H_k\hat{x}_k)$$

$$\Sigma'=\Sigma_0-K\Sigma_0=H_kP_{k}H_k^T-KH_kP_{k}H_k^T$$

$$K=\frac{\Sigma_0}{\Sigma_0+\Sigma_1}=\frac{H_kP_{k}H_k^T}{H_kP_{k}H_k^T+R_{k}}$$

- 注意，此时随机变量 $S_{k}'$ 仍是在观测空间中表示的，转换回状态空间为：

$$\mu'=\hat{x}_{k}+K(z_{k}-H_k\hat{x}_k)\tag{3}$$

$$\Sigma'=P_{k}-KH_kP_{k}\tag{4}$$

$$K=\frac{P_{k}H_k^T}{H_kP_{k}H_k^T+R_{k}}\tag{5}$$

- 至此我们就得到系统状态的最佳（后验）估计。
# 总结
- 综上所述，式$(1)(2)(3)(4)(5)$就是卡尔曼滤波的所有公式：
	- 式$(1)(2)$表示**高斯过程**求系统状态先验分布；
	- 式$(3)(4)(5)$表示由先验和似然求系统状态后验分布（**贝叶斯推断**），该后验作为最优估计输出给下一次迭代;
	- 不断迭代就可以得到系统在任意时间点下的最优状态估计；
- 卡尔曼滤波器是一种状态观测器，从系统初始状态开始迭代，使得我们对系统的判断不再只能依靠传感器的读数，而是可以结合系统的状态空间方程，从而提升观测的准确性。
### 插句题外话：
- 卡尔曼滤波贝叶斯推断的过程类似于贝叶斯回归的参数学习过程，只不过贝叶斯回归是在参数空间，而卡尔曼滤波是在状态空间，具体可参考我另一篇博文：[贝叶斯回归](https://blog.csdn.net/qq_36013249/article/details/105932395)；
![img](/img/kalmanfilter_4.png)